flowchart LR
  subgraph Frontend
    UI["SPA (index.html)\nBootstrap/Chart.js"]
    JS["main.js / dashboard.js\n- Navegação SPA\n- CRUD via fetch\n- Caches locais\n- Modais"]
    UI --> JS
  end

  subgraph Backend[Express.js]
    RT["Rotas /api/*\n(auth, usuarios, servicos, clientes, agendamentos, dashboard, tenant, backup, whatsapp)"]
    MD["Middlewares\n- auth (JWT)\n- tenant\n- validation (Joi)"]
    CTL["Controllers\n- Usuario/Servico/Cliente/Agendamento\n- Admin\n- Dashboard"]
    SVC["Services\n- Auth/Dashboard/Notification\n- Cron/Slot/Backup"]
    RT --> MD --> CTL --> SVC
  end

  subgraph DB[SQLite]
    DBFile["data/agendamento_dev.db"]
    TB[("Tabelas\nusuarios\nservicos\nclientes\nagendamentos\nslots\nnotificacoes\ndashboard_cache")]
    DBFile --> TB
  end

  JS -- fetch JWT --> RT
  SVC -- queries --> DB

  subgraph Infra
    SEC["Segurança\nHelmet (CSP) / CORS / RateLimit"]
    LOG["Logs\nmorgan dev/combined"]
    CRON["Cron Jobs\nENABLE_CRON=false (dev)"]
  end

  Backend -. usa .-> Infra

